<tr>
  <td><%= payment.user.name %></td>
  <% if payment.user_id == @session.user.id %>
  <% form_for :payment, :url => {:action => :update} do |form| %>
  <input type="hidden"
         id="id"
         name="id"
         value="<%= payment.id %>" />
  <td><%= form.text_field :name, :size => 20, :value => payment.name %></td>
  <% @users.each do |user| %>
  <% if payment.has_user_component?(user) %>
  <% if payment.user_component_paid?(user) %>
  <td class="paid">
    <% else %>
  <td class="not_paid">
    <% end %>
    <input id="pc"
           size="5"
           name="payment_components[<%= user.id %>][paid]"
           value="<%= payment.user_component_paid(user) %>"/> /
    <%= number_to_currency(payment.user_component_value(user), :unit => "&euro;") %>
  </td>
    <% else %>
  <td>N/A</td>
  <% end %>
  <% end %>
  <td><%= number_to_currency(payment.value, :unit => "&euro;") %></td>
  <td><%= payment.created_at.strftime("%d/%m/%Y") %></td>
  <td class="table-form-centered">
    <%= submit_tag "Update Payment", :class => "submit" %>
  </td>
  <% end %>
  <% else %>
  <td><%= payment.name %></td>
  <% @users.each do |user| %>
  <% pu = payment.user_component(user) %>
  <% if pu %>
  <% if pu.paid? %>
  <td class="paid">
    <% else %>
  <td class="not_paid">
    <% end %>
    <%= number_to_currency(pu.paid, :unit => "&euro;") %> /
    <%= number_to_currency(pu.value, :unit => "&euro;") %>
  </td>
  <% else %>
  <td>N/A</td>
  <% end %>
  <% end %>
  <td><%= number_to_currency(payment.value, :unit => "&euro;") %></td>
  <td><%= payment.created_at.strftime("%d/%m/%Y") %></td>
  <td />
  <% end %>
</tr>
